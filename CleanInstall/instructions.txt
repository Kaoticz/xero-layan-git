#!/bin/bash

# Setup keyboard layout
#localectl set-keymap --no-convert br-abnt

# Setup system clock
timedatectl set-timezone America/Sao_Paulo
timedatectl set-ntp true

# Setup disk partitions
cfdisk /dev/sda

# 128M for boot partition, primary
# Everything else for storage, primary

# Write the filesystem
mkfs.ext4 /dev/sda1
mkfs.ext4 /dev/sda2

# Mount the root partition
mount /dev/sda2 /mnt

# Create the boot directory
mkdir /mnt/boot

# Mount the boot directory
mount /dev/sda1 /mnt/boot

# Install the operational system
# Pick one of the following

## Regular Kernel
pacstrap /mnt base base-devel linux linux-firmware nvidia bash nano

## Or
## LTS Kernel
pacstrap /mnt base base-devel linux-lts linux-firmware nvidia-lts bash nano

# Create the fstab file
genfstab -U /mnt >> /mnt/etc/fstab

# Log into the installed system
arch-chroot /mnt /bin/bash

# Setup keyboard layout
localectl set-keymap --no-convert br-abnt

# Run the following
curl -OL https://raw.githubusercontent.com/Kaoticz/xero-layan-git/arch/CleanInstall/install1.sh
bash install1.sh

# Exit the local system
exit

# Unmount everything
umount -R /mnt

# Reboot the system
reboot

# Run the following
curl -OL https://raw.githubusercontent.com/Kaoticz/xero-layan-git/arch/CleanInstall/install2.sh
bash install2.sh

# Follow the instructions. Computer will reboot at the end.

# Open the terminal and run the script in the user home directory
bash install3.sh

# Follow the instructions. Computer will reboot at the end.
# Done